[gd_scene load_steps=55 format=3 uid="uid://b0wly204l2ena"]

[ext_resource type="Script" uid="uid://jcofvi7o5sx6" path="res://scripts/entities/player/PlayerController.gd" id="1_3d8xk"]
[ext_resource type="Texture2D" uid="uid://cqcy0ktn0qa3i" path="res://assets/debug/textures/Light/texture_07.png" id="1_hcqin"]
[ext_resource type="Script" uid="uid://3jpbtgk2ox3v" path="res://scripts/state-machine/StateMachine.gd" id="3_0kck2"]
[ext_resource type="Script" uid="uid://r7ggknfdcijq" path="res://scripts/entities/player/states/PlayerWalking.gd" id="3_jeygn"]
[ext_resource type="Script" uid="uid://cvxdrd2m5vbgf" path="res://scripts/entities/player/states/PlayerCombat.gd" id="4_0kck2"]
[ext_resource type="Script" uid="uid://7bo8ucqhauky" path="res://scripts/resources/stat_data/StatModifier.gd" id="5_250kt"]
[ext_resource type="Script" uid="uid://dgw2r4365cdvh" path="res://scripts/entities/player/states/TransientPlayerRunning.gd" id="5_d3mra"]
[ext_resource type="Curve" uid="uid://bo585vefbn04d" path="res://resources/curves/constant_curve.tres" id="5_ohd7q"]
[ext_resource type="Script" uid="uid://cqsis73v5qr3t" path="res://scripts/entities/player/states/TransientPlayerBlock.gd" id="7_0qcyq"]
[ext_resource type="Script" uid="uid://dofyti6k6j38s" path="res://scripts/entities/player/states/TransientPlayerDodge.gd" id="8_d3mra"]
[ext_resource type="Resource" uid="uid://xn4rk8nmql2l" path="res://resources/weapons/one_handed_sword/items/sword.tres" id="8_tofid"]
[ext_resource type="Script" uid="uid://b8tw0twqghynv" path="res://scripts/entities/components/EquipmentController.gd" id="9_0qcyq"]
[ext_resource type="Script" uid="uid://cq8ba60xa7owg" path="res://scripts/entities/player/states/TransientPlayerLightAttack.gd" id="9_lmqpx"]
[ext_resource type="Script" uid="uid://dftysctitabs5" path="res://scripts/resources/ItemData.gd" id="10_t2i2o"]
[ext_resource type="Script" uid="uid://l1x7uep16mgb" path="res://scripts/entities/player/states/TransientPlayerHeavyAttack.gd" id="12_tm53r"]
[ext_resource type="PackedScene" uid="uid://ccbrfe6blnh8b" path="res://prefabs/components/combat-controller.tscn" id="15_250kt"]
[ext_resource type="PackedScene" uid="uid://bu670d203u4x0" path="res://prefabs/components/combo-controller.tscn" id="16_801f5"]
[ext_resource type="Resource" uid="uid://ckvaigu87y8wr" path="res://resources/weapons/one_handed_sword/profiles/oh_heavy_stab.tres" id="16_gqpng"]
[ext_resource type="AnimationLibrary" uid="uid://b5kwie374few5" path="res://animations/combat.res" id="16_wgn03"]
[ext_resource type="PackedScene" uid="uid://ccmo4puth1w0" path="res://prefabs/components/stats/stat-controller.tscn" id="17_250kt"]
[ext_resource type="Script" uid="uid://bg3dy1jtahxwh" path="res://scripts/debug/DebugAnimationCallback.gd" id="17_k1vjg"]
[ext_resource type="PackedScene" uid="uid://dwhw8ucx5ml6u" path="res://prefabs/components/block-controller.tscn" id="18_tm53r"]
[ext_resource type="PackedScene" uid="uid://d3etlwmr2c7sb" path="res://prefabs/components/hit-controller.tscn" id="19_iv77g"]
[ext_resource type="Script" uid="uid://cpr3qwl7h1m2j" path="res://scripts/entities/components/interaction/InteractionController.gd" id="22_klqbu"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_hcqin"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_3d8xk"]
albedo_texture = ExtResource("1_hcqin")
uv1_triplanar = true

[sub_resource type="CapsuleMesh" id="CapsuleMesh_hcqin"]
material = SubResource("StandardMaterial3D_3d8xk")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_hcqin"]
albedo_color = Color(0.26779, 0.26779, 0.26779, 1)

[sub_resource type="BoxMesh" id="BoxMesh_3d8xk"]
material = SubResource("StandardMaterial3D_hcqin")
size = Vector3(0.75, 0.25, 0.25)

[sub_resource type="Resource" id="Resource_ohd7q"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 14.0
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 0
duration_ms = 0
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Curve" id="Curve_ohd7q"]
_limits = [0.0, 10.0, 0.0, 1.0]
_data = [Vector2(0, 10), 0.0, 2.8026412, 0, 0, Vector2(0.62430173, 6.857559), -13.200561, -13.200561, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="Resource" id="Resource_6f8ny"]
script = ExtResource("5_250kt")
target_stat = 2
modifier_value = 0.5
modifier_stacking_rule = 2
modifier_type = 2
modifier_id = "movement_stamina"
modifier_tier = 0
duration_ms = 0
falloff_operation = SubResource("Curve_ohd7q")
falloff_tracked_property = 1
falloff_linked_stat = 3
recurring_frequency_ms = 250
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_gqpng"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 20.0
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 2
duration_ms = 0
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_klqbu"]
script = ExtResource("5_250kt")
target_stat = 2
modifier_value = -2.0
modifier_stacking_rule = 1
modifier_type = 2
modifier_id = "movement_stamina"
modifier_tier = 1
duration_ms = 0
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 3
recurring_frequency_ms = 250
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_tm53r"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 7.0
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 1
duration_ms = -1
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="CylinderShape3D" id="CylinderShape3D_3d8xk"]
radius = 20.0

[sub_resource type="Resource" id="Resource_iv77g"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 1.5
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 2
duration_ms = -1
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_1ou4q"]
script = ExtResource("5_250kt")
target_stat = 2
modifier_value = -15.0
modifier_stacking_rule = 1
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_b13w7"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 2.0
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 2
duration_ms = -1
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_801f5"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 1.0
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 2
duration_ms = -1
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="CylinderShape3D" id="CylinderShape3D_klqbu"]
radius = 2.0

[sub_resource type="Animation" id="Animation_wgn03"]
length = 0.001
loop_mode = 1
tracks/0/type = "position_3d"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Rig/HandR")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = PackedFloat32Array(0, 1, 0.75, 0, -0.5)
tracks/1/type = "position_3d"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../Model")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = PackedFloat32Array(0, 1, 0, 0, 0)

[sub_resource type="AnimationLibrary" id="AnimationLibrary_k1vjg"]
_data = {
&"RESET": SubResource("Animation_wgn03")
}

[sub_resource type="Animation" id="Animation_ohd7q"]
loop_mode = 1
tracks/0/type = "position_3d"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Model")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = PackedFloat32Array(0, 1, 0, 0, 0, 0.5, 1, 0, 0.133, 0, 1, 1, 0, 0, 0)
tracks/1/type = "rotation_3d"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../Model")
tracks/1/interp = 0
tracks/1/loop_wrap = true
tracks/1/keys = PackedFloat32Array(0, 1, 0, 0, 0, 1, 0.2, 1, 0, -0.043619387, 0, 0.99904823, 0.5, 1, 0, 0, 0, 1, 0.8, 1, 0, 0.043619387, 0, 0.99904823, 1, 1, 0, 0, 0, 1)

[sub_resource type="Animation" id="Animation_gqpng"]
loop_mode = 1
tracks/0/type = "position_3d"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Model")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = PackedFloat32Array(0, 1, 0, 0.018710451, 0)
tracks/1/type = "rotation_3d"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../Model")
tracks/1/interp = 0
tracks/1/loop_wrap = true
tracks/1/keys = PackedFloat32Array(0, 1, 0, 0, 0, 1, 0.3, 1, 0, 0, -0.13052617, 0.9914448, 0.5, 1, 0, 0, 0, 1, 0.7, 1, 0, 0, 0.13052617, 0.9914448, 1, 1, 0, 0, 0, 1)

[sub_resource type="AnimationLibrary" id="AnimationLibrary_tm53r"]
_data = {
&"loco_idle": SubResource("Animation_ohd7q"),
&"loco_move": SubResource("Animation_gqpng")
}

[sub_resource type="AnimationNodeAdd2" id="AnimationNodeAdd2_gqpng"]
filter_enabled = true
filters = ["../Rig/HandR"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_250kt"]
animation = &"combat/oh_sword_swing_l"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ohd7q"]
animation = &"loco/loco_idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_gqpng"]
animation = &"loco/loco_move"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_tm53r"]
blend_point_0/node = SubResource("AnimationNodeAnimation_ohd7q")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("AnimationNodeAnimation_gqpng")
blend_point_1/pos = 1.0
min_space = 0.0
value_label = "input"

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_gqpng"]
filter_enabled = true
filters = [".", "../Rig/HandR"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_tm53r"]
animation = &"RESET"

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_tm53r"]
nodes/output/position = Vector2(1213.3334, 120)
nodes/AttackAnimation/node = SubResource("AnimationNodeAnimation_250kt")
nodes/AttackAnimation/position = Vector2(-120, 240)
nodes/Oneshot_LightAttack/node = SubResource("AnimationNodeOneShot_gqpng")
nodes/Oneshot_LightAttack/position = Vector2(386.66666, 106.666664)
nodes/MovementBlend/node = SubResource("AnimationNodeBlendSpace1D_tm53r")
nodes/MovementBlend/position = Vector2(-120, -106.666664)
nodes/StanceAnimation/node = SubResource("AnimationNodeAnimation_tm53r")
nodes/StanceAnimation/position = Vector2(-120, 80)
nodes/Add2/node = SubResource("AnimationNodeAdd2_gqpng")
nodes/Add2/position = Vector2(133.33333, -66.666664)
node_connections = [&"output", 0, &"Oneshot_LightAttack", &"Oneshot_LightAttack", 0, &"Add2", &"Oneshot_LightAttack", 1, &"AttackAnimation", &"Add2", 0, &"MovementBlend", &"Add2", 1, &"StanceAnimation"]

[node name="PlayerController" type="CharacterBody3D" node_paths=PackedStringArray("stat_controller", "animation_tree")]
collision_layer = 3
collision_mask = 5
script = ExtResource("1_3d8xk")
stat_controller = NodePath("StatController")
animation_tree = NodePath("AnimationTree")

[node name="Collider" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_hcqin")

[node name="Model" type="Node3D" parent="."]
transform = Transform3D(0.99619466, 0, 0.08715574, 0, 0.99999994, 0, -0.08715573, 0, 0.9961947, 0, 0, 0)

[node name="BodyMesh" type="MeshInstance3D" parent="Model"]
mesh = SubResource("CapsuleMesh_hcqin")
skeleton = NodePath("../..")

[node name="Eyes" type="Node3D" parent="Model"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.549, -0.399)

[node name="EyesMesh" type="MeshInstance3D" parent="Model/Eyes"]
mesh = SubResource("BoxMesh_3d8xk")
skeleton = NodePath("../../..")

[node name="StateMachine" type="Node3D" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("3_0kck2")
initial_state = NodePath("walking")

[node name="walking" type="Node" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("3_jeygn")
stat_controller = NodePath("../../StatController")
walking_stat = SubResource("Resource_ohd7q")
stamina_stat = SubResource("Resource_6f8ny")

[node name="trans_running" type="Node" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("5_d3mra")
stat_controller = NodePath("../../StatController")
speed_stat = SubResource("Resource_gqpng")
stamina_mod = SubResource("Resource_klqbu")

[node name="combat" type="Node3D" parent="StateMachine"]
script = ExtResource("4_0kck2")
speed_stat = SubResource("Resource_tm53r")
heavy_attack_hold_time_ms = 250

[node name="LockonArea" type="Area3D" parent="StateMachine/combat"]
collision_layer = 0
collision_mask = 2

[node name="CollisionShape3D" type="CollisionShape3D" parent="StateMachine/combat/LockonArea"]
shape = SubResource("CylinderShape3D_3d8xk")
debug_color = Color(0.694854, 0.494987, 0.0234025, 0.42)

[node name="trans_block" type="Node" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("7_0qcyq")
stat_controller = NodePath("../../StatController")
speed_stat = SubResource("Resource_iv77g")

[node name="trans_dodge" type="Node" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("8_d3mra")
stat_controller = NodePath("../../StatController")
dodge_stat_mod = SubResource("Resource_1ou4q")

[node name="trans_attack_light" type="Node" parent="StateMachine"]
script = ExtResource("9_lmqpx")
speed_stat = SubResource("Resource_b13w7")

[node name="trans_attack_heavy" type="Node" parent="StateMachine"]
script = ExtResource("12_tm53r")
speed_stat = SubResource("Resource_801f5")

[node name="Rig" type="Node3D" parent="."]

[node name="HandR" type="Node3D" parent="Rig"]
transform = Transform3D(0.99999934, 0, 0, 0, 0.9999998, 0, 0, 0, 0.99999946, 0.75, 0, -0.5)

[node name="HandL" type="Node3D" parent="Rig"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.75, 0, -0.5)

[node name="HitscanRoot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -1)

[node name="InteractionController" type="Node" parent="." node_paths=PackedStringArray("search_area")]
script = ExtResource("22_klqbu")
search_area = NodePath("../InteractionArea")
metadata/_custom_type_script = "uid://cpr3qwl7h1m2j"

[node name="InteractionArea" type="Area3D" parent="."]
collision_mask = 8

[node name="CollisionShape3D" type="CollisionShape3D" parent="InteractionArea"]
shape = SubResource("CylinderShape3D_klqbu")
debug_color = Color(0, 0.63521165, 0.42367238, 0.41960785)

[node name="EquipmentController" type="Node" parent="." node_paths=PackedStringArray("SlotPivots")]
script = ExtResource("9_0qcyq")
EquipmentSlots = Array[ExtResource("10_t2i2o")]([ExtResource("8_tofid")])
SlotPivots = [NodePath("../Rig/HandR")]
SlotNames = Array[String](["Main Weapon"])
SlotConstraints = Array[int]([0])

[node name="ComboController" parent="." node_paths=PackedStringArray("combat_controller", "equipment_controller") instance=ExtResource("16_801f5")]
combat_controller = NodePath("../AttackController")
equipment_controller = NodePath("../EquipmentController")

[node name="AttackController" parent="." node_paths=PackedStringArray("hitscan_root", "animation_tree", "debugAnimator") instance=ExtResource("15_250kt")]
hitscan_root = NodePath("../HitscanRoot")
animation_tree = NodePath("../AnimationTree")
currentProfile = ExtResource("16_gqpng")
active_scan_zones = Array[bool]([false])
debugAnimator = NodePath("../PlayerAnimation")

[node name="BlockController" parent="." node_paths=PackedStringArray("hit_controller") instance=ExtResource("18_tm53r")]
hit_controller = NodePath("../HitController")

[node name="HitController" parent="." instance=ExtResource("19_iv77g")]

[node name="StatController" parent="." instance=ExtResource("17_250kt")]
TrackedStats = Array[int]([0, 1, 2, 3, 4, 5, 6])
CollectedStats = Array[int]([1, 3, 4, 6])

[node name="PlayerAnimation" type="AnimationPlayer" parent="."]
root_node = NodePath("../AttackController")
libraries = {
&"": SubResource("AnimationLibrary_k1vjg"),
&"combat": ExtResource("16_wgn03"),
&"loco": SubResource("AnimationLibrary_tm53r")
}
playback_default_blend_time = 1.0

[node name="AnimationTree" type="AnimationTree" parent="."]
root_node = NodePath("../AttackController")
tree_root = SubResource("AnimationNodeBlendTree_tm53r")
anim_player = NodePath("../PlayerAnimation")
parameters/Oneshot_LightAttack/active = false
parameters/Oneshot_LightAttack/internal_active = false
parameters/Oneshot_LightAttack/request = 0
parameters/MovementBlend/blend_position = 0.0
parameters/Add2/add_amount = 1.0

[node name="DebugAnimationCallback" type="Node" parent="." node_paths=PackedStringArray("Animator", "track_targets")]
script = ExtResource("17_k1vjg")
Animator = NodePath("../PlayerAnimation")
track_targets = [NodePath("../AttackController")]
callArray = [[{
"args": [0],
"method": &"internal_begin_hitscan"
}, {
"args": [],
"method": &"internal_lock_interrupt"
}, {
"args": [],
"method": &"internal_unlock_interrupt"
}, {
"args": [0],
"method": &"internal_end_hitscan"
}]]
keyTimes = [[0.3, 0.32881567, 0.7943216, 0.8]]
currentKeyFrames = Array[int]([3])
