[gd_scene load_steps=36 format=3 uid="uid://b0wly204l2ena"]

[ext_resource type="Script" uid="uid://jcofvi7o5sx6" path="res://scripts/entities/player/PlayerController.gd" id="1_3d8xk"]
[ext_resource type="Texture2D" uid="uid://cqcy0ktn0qa3i" path="res://assets/debug/textures/Light/texture_07.png" id="1_hcqin"]
[ext_resource type="Script" uid="uid://3jpbtgk2ox3v" path="res://scripts/state-machine/StateMachine.gd" id="3_0kck2"]
[ext_resource type="Script" uid="uid://r7ggknfdcijq" path="res://scripts/entities/player/states/PlayerWalking.gd" id="3_jeygn"]
[ext_resource type="Script" uid="uid://cvxdrd2m5vbgf" path="res://scripts/entities/player/states/PlayerCombat.gd" id="4_0kck2"]
[ext_resource type="Script" uid="uid://7bo8ucqhauky" path="res://scripts/resources/attack_profile/StatModifier.gd" id="5_250kt"]
[ext_resource type="Script" uid="uid://dgw2r4365cdvh" path="res://scripts/entities/player/states/TransientPlayerRunning.gd" id="5_d3mra"]
[ext_resource type="Curve" uid="uid://bo585vefbn04d" path="res://resources/curves/constant_curve.tres" id="5_ohd7q"]
[ext_resource type="Script" uid="uid://cqsis73v5qr3t" path="res://scripts/entities/player/states/TransientPlayerBlock.gd" id="7_0qcyq"]
[ext_resource type="Script" uid="uid://dofyti6k6j38s" path="res://scripts/entities/player/states/TransientPlayerDodge.gd" id="8_d3mra"]
[ext_resource type="Resource" uid="uid://xn4rk8nmql2l" path="res://resources/weapons/sword.tres" id="8_tofid"]
[ext_resource type="Script" uid="uid://b8tw0twqghynv" path="res://scripts/entities/player/EquipmentManager.gd" id="9_0qcyq"]
[ext_resource type="Script" uid="uid://cq8ba60xa7owg" path="res://scripts/entities/player/states/TransientPlayerAttack.gd" id="9_lmqpx"]
[ext_resource type="Script" uid="uid://byby0cr46ugkv" path="res://scripts/entities/CombatController.gd" id="10_d3mra"]
[ext_resource type="Script" uid="uid://dftysctitabs5" path="res://scripts/resources/ItemData.gd" id="10_t2i2o"]
[ext_resource type="AnimationLibrary" uid="uid://b5kwie374few5" path="res://animations/combat.res" id="16_wgn03"]
[ext_resource type="PackedScene" uid="uid://ccmo4puth1w0" path="res://prefabs/stats/stat-controller.tscn" id="17_250kt"]
[ext_resource type="Script" uid="uid://bg3dy1jtahxwh" path="res://scripts/debug/DebugAnimationCallback.gd" id="17_k1vjg"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_hcqin"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_3d8xk"]
albedo_texture = ExtResource("1_hcqin")
uv1_triplanar = true

[sub_resource type="CapsuleMesh" id="CapsuleMesh_hcqin"]
material = SubResource("StandardMaterial3D_3d8xk")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_hcqin"]
albedo_color = Color(0.26779, 0.26779, 0.26779, 1)

[sub_resource type="BoxMesh" id="BoxMesh_3d8xk"]
material = SubResource("StandardMaterial3D_hcqin")
size = Vector3(0.75, 0.25, 0.25)

[sub_resource type="Resource" id="Resource_ohd7q"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 14.0
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 0
duration_ms = 0
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Curve" id="Curve_ohd7q"]
_limits = [0.0, 10.0, 0.0, 1.0]
_data = [Vector2(0, 10), 0.0, 2.8026412, 0, 0, Vector2(0.62430173, 6.857559), -13.200561, -13.200561, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="Resource" id="Resource_6f8ny"]
script = ExtResource("5_250kt")
target_stat = 2
modifier_value = 0.5
modifier_stacking_rule = 2
modifier_type = 2
modifier_id = "movement_stamina"
modifier_tier = 0
duration_ms = 0
falloff_operation = SubResource("Curve_ohd7q")
falloff_tracked_property = 1
falloff_linked_stat = 3
recurring_frequency_ms = 250
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_gqpng"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 20.0
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 2
duration_ms = 0
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_klqbu"]
script = ExtResource("5_250kt")
target_stat = 2
modifier_value = -2.0
modifier_stacking_rule = 1
modifier_type = 2
modifier_id = "movement_stamina"
modifier_tier = 1
duration_ms = 0
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 3
recurring_frequency_ms = 250
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_tm53r"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 7.0
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 1
duration_ms = -1
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="CylinderShape3D" id="CylinderShape3D_3d8xk"]
radius = 20.0

[sub_resource type="Resource" id="Resource_iv77g"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 1.5
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 2
duration_ms = -1
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_1ou4q"]
script = ExtResource("5_250kt")
target_stat = 2
modifier_value = -15.0
modifier_stacking_rule = 1
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Resource" id="Resource_801f5"]
script = ExtResource("5_250kt")
target_stat = 4
modifier_value = 1.5
modifier_stacking_rule = 2
modifier_type = 1
modifier_id = "movement_speed"
modifier_tier = 2
duration_ms = -1
falloff_operation = ExtResource("5_ohd7q")
falloff_tracked_property = 0
falloff_linked_stat = 0
metadata/_custom_type_script = "uid://7bo8ucqhauky"

[sub_resource type="Animation" id="Animation_wgn03"]
length = 0.001
tracks/0/type = "position_3d"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Rig/HandR")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = PackedFloat32Array(0, 1, 0.75, 0, -0.5)

[sub_resource type="AnimationLibrary" id="AnimationLibrary_k1vjg"]
_data = {
&"RESET": SubResource("Animation_wgn03")
}

[node name="PlayerController" type="CharacterBody3D" node_paths=PackedStringArray("stat_controller")]
collision_mask = 3
script = ExtResource("1_3d8xk")
stat_controller = NodePath("StatController")

[node name="Collider" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_hcqin")

[node name="Model" type="Node3D" parent="."]

[node name="BodyMesh" type="MeshInstance3D" parent="Model"]
mesh = SubResource("CapsuleMesh_hcqin")
skeleton = NodePath("../..")

[node name="Eyes" type="Node3D" parent="Model"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.549, -0.399)

[node name="EyesMesh" type="MeshInstance3D" parent="Model/Eyes"]
mesh = SubResource("BoxMesh_3d8xk")
skeleton = NodePath("../../..")

[node name="StateMachine" type="Node3D" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("3_0kck2")
initial_state = NodePath("walking")

[node name="walking" type="Node" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("3_jeygn")
stat_controller = NodePath("../../StatController")
walking_stat = SubResource("Resource_ohd7q")
stamina_stat = SubResource("Resource_6f8ny")

[node name="trans_running" type="Node" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("5_d3mra")
stat_controller = NodePath("../../StatController")
speed_stat = SubResource("Resource_gqpng")
stamina_mod = SubResource("Resource_klqbu")

[node name="combat" type="Node3D" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("4_0kck2")
stat_controller = NodePath("../../StatController")
speed_stat = SubResource("Resource_tm53r")

[node name="LockonArea" type="Area3D" parent="StateMachine/combat"]
collision_layer = 0
collision_mask = 2

[node name="CollisionShape3D" type="CollisionShape3D" parent="StateMachine/combat/LockonArea"]
shape = SubResource("CylinderShape3D_3d8xk")
debug_color = Color(0.694854, 0.494987, 0.0234025, 0.42)

[node name="trans_block" type="Node" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("7_0qcyq")
stat_controller = NodePath("../../StatController")
speed_stat = SubResource("Resource_iv77g")

[node name="trans_dodge" type="Node" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("8_d3mra")
stat_controller = NodePath("../../StatController")
dodge_stat_mod = SubResource("Resource_1ou4q")

[node name="trans_attack" type="Node" parent="StateMachine" node_paths=PackedStringArray("stat_controller")]
script = ExtResource("9_lmqpx")
stat_controller = NodePath("../../StatController")
speed_stat = SubResource("Resource_801f5")

[node name="Rig" type="Node3D" parent="."]

[node name="HandR" type="Node3D" parent="Rig"]
transform = Transform3D(0.99999964, 0, 0, 0, -0.44250768, 0.89676416, 0, -0.8967644, -0.44250757, 0.75, 0, -0.5)

[node name="HandL" type="Node3D" parent="Rig"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.75, 0, -0.5)

[node name="HitscanRoot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -1)

[node name="Equipment" type="Node" parent="." node_paths=PackedStringArray("SlotPivots")]
script = ExtResource("9_0qcyq")
EquipmentSlots = Array[ExtResource("10_t2i2o")]([ExtResource("8_tofid")])
SlotPivots = [NodePath("../Rig/HandR")]
SlotNames = Array[String](["Main Weapon"])
SlotConstraints = Array[int]([0])

[node name="CombatController" type="Node" parent="." node_paths=PackedStringArray("hitscan_root", "animator")]
script = ExtResource("10_d3mra")
hitscan_root = NodePath("../HitscanRoot")
animator = NodePath("CombatPlayer")
active_scan_zones = Array[bool]([false])

[node name="CombatPlayer" type="AnimationPlayer" parent="CombatController"]
libraries = {
&"": SubResource("AnimationLibrary_k1vjg"),
&"combat": ExtResource("16_wgn03")
}
speed_scale = 0.074

[node name="DebugAnimationCallback" type="Node" parent="CombatController" node_paths=PackedStringArray("Animator", "track_targets")]
script = ExtResource("17_k1vjg")
Animator = NodePath("../CombatPlayer")
track_targets = [NodePath("..")]
callArray = [[{
"args": [0],
"method": &"internal_begin_hitscan"
}, {
"args": [],
"method": &"internal_lock_interrupt"
}, {
"args": [0],
"method": &"internal_end_hitscan"
}, {
"args": [],
"method": &"internal_unlock_interrupt"
}]]
keyTimes = [[0.13333334, 0.2, 0.4, 0.401887]]
currentKeyFrames = Array[int]([4])

[node name="StatController" parent="." instance=ExtResource("17_250kt")]
TrackedStats = Array[float]([100.0, 100.0, 100.0, 100.0, 14.0, 0.0])
